#!/usr/bin/env bash

set -euo pipefail

# -----------------------------------------------------------------------------
# SETUP
# -----------------------------------------------------------------------------

declare -r __VERSION="0.0.1"
__FILE="$(basename -- "$0")"
__DIR="$(dirname -- "$0")"
declare -r __FILE __DIR
declare -r __NAME="$__FILE"

# -----------------------------------------------------------------------------
# CONFIG
# -----------------------------------------------------------------------------

o_flag=1

# -----------------------------------------------------------------------------
# PRIVATE interfaces
# -----------------------------------------------------------------------------

_display-hello() {
  echo "Hello, $*!"
}

# -----------------------------------------------------------------------------
# PUBLIC interfaces
# -----------------------------------------------------------------------------

prepend-hello() { # Prepend Hello to what you type, ex: `prepend-hello John`
  _display-hello "$@"
  ##cursor##
}

# -----------------------------------------------------------------------------

_parse_options() {
  while [[ $# -ge 1 ]]; do
    case $1 in

      --flag)
        shift
        o_flag=$1
        shift
        continue
        ;;

    esac

    if [[ $# -gt 0 ]]; then
      shift
    fi
  done
}

help() { # Display this helpful help information
  local functions=""
  while IFS= read -r f; do
    if [[ $f =~ ([a-zA-Z][a-zA-Z0-9_-]*)[[:space:]]*\(\)[[:space:]]*{([[:space:]]*#[[:space:]]*)?(.*) ]]; then
      local sub="${BASH_REMATCH[1]}"
      local hel=${BASH_REMATCH[3]}
      functions+="   ${sub}#${hel}"$'\n'
    fi
  done < <(grep -E "^[a-zA-Z][a-zA-Z0-9_-]*?\s*\(\)\s*\{" "$0")
  echo "$__NAME v$__VERSION"
  echo "Usage: $__FILE <task> [options]"
  echo ""
  echo "Tasks"
  column -t -s '#' <<< "$functions"
  echo ""
  echo "Options"
  echo "   --flag   on"
  echo ""
}

_parse_options "$@"

"${@:-help}"
